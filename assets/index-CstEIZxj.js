(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function i(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(a){if(a.ep)return;a.ep=!0;const r=i(a);fetch(a.href,r)}})();class T{constructor(e=null){this.token=e,this.apiBase="https://api.github.com"}async getTree(e,i="main"){const c={Accept:"application/vnd.github.v3+json"};this.token&&(c.Authorization=`token ${this.token}`);const a=await fetch(`${this.apiBase}/repos/${e}/commits/${i}`,{headers:c});if(!a.ok)throw a.status===404?new Error("Repository not found or Private (Token required)."):a.status===403?new Error("API Limit Exceeded."):new Error(`GitHub API Error: ${a.statusText}`);const{sha:r}=await a.json(),l=await fetch(`${this.apiBase}/repos/${e}/git/trees/${r}?recursive=1`,{headers:c});if(!l.ok)throw new Error("Failed to fetch tree data.");const p=await l.json();return{tree:p.tree,truncated:p.truncated}}async getTree(e,i="main"){const c={Accept:"application/vnd.github.v3+json"};this.token&&(c.Authorization=`token ${this.token}`);let a=i,r=null,l=await fetch(`${this.apiBase}/repos/${e}/commits/${a}`,{headers:c});if(!l.ok&&(l.status===404||l.status===422)){const o=await fetch(`${this.apiBase}/repos/${e}`,{headers:c});if(o.ok){const u=(await o.json()).default_branch;u&&u!==a&&(a=u,l=await fetch(`${this.apiBase}/repos/${e}/commits/${a}`,{headers:c}))}else if(o.status===404)throw new Error(`Repository "${e}" not found or is private.`)}if(!l.ok)throw l.status===403?new Error("API Rate Limit Exceeded."):l.status===404||l.status===422?new Error(`Branch "${i}" not found in ${e}.`):new Error(`GitHub API Error (${l.status}): ${l.statusText}`);r=(await l.json()).sha;const d=await fetch(`${this.apiBase}/repos/${e}/git/trees/${r}?recursive=1`,{headers:c});if(!d.ok)throw new Error("Failed to fetch tree data.");const s=await d.json();return{tree:s.tree,truncated:s.truncated,branch:a}}sortTree(e,i="folder-az"){if(!e)return[];const a=(s=>{const o={children:[]},h={"":o};return s.forEach(u=>{h[u.path]={...u,name:u.path.split("/").pop(),children:[]}}),s.forEach(u=>{const y=u.path.split("/");y.pop(),(h[y.join("/")]||o).children.push(h[u.path])}),o.children})(e),r=(s,o)=>s.name.localeCompare(o.name),l={"folder-az":(s,o)=>s.type==="tree"&&o.type!=="tree"?-1:s.type!=="tree"&&o.type==="tree"?1:r(s,o),"folder-za":(s,o)=>s.type==="tree"&&o.type!=="tree"?-1:s.type!=="tree"&&o.type==="tree"?1:r(o,s),"alpha-az":(s,o)=>r(s,o),"alpha-za":(s,o)=>r(o,s)},p=s=>{s.sort(l[i]||l["folder-az"]),s.forEach(o=>{o.children.length>0&&p(o.children)})};p(a);const d=s=>{let o=[];return s.forEach(h=>{const{children:u,...y}=h;o.push(y),u.length>0&&(o=o.concat(d(u)))}),o};return d(a)}generateAsciiTree(e,i={icons:!1}){if(!e||e.length===0)return"";const c={name:".",children:[]},a={"":c};e.forEach(d=>{a[d.path]={...d,name:d.path.split("/").pop(),children:[]}}),e.forEach(d=>{const s=d.path.split("/");s.pop(),(a[s.join("/")]||c).children.push(a[d.path])});const r=d=>{d.sort((s,o)=>s.type==="tree"&&o.type!=="tree"?-1:s.type!=="tree"&&o.type==="tree"?1:s.name.localeCompare(o.name)),d.forEach(s=>r(s.children))};r(c.children);let l="";const p=(d,s,o)=>{const h=o?"â””â”€â”€ ":"â”œâ”€â”€ ",u=o?"    ":"â”‚   ";let y="";i.icons&&(y=d.type==="tree"?"ðŸ“ ":"ðŸ“„ "),l+=`${s}${h}${y}${d.name}${d.type==="tree"&&!i.icons?"/":""}
`,d.children&&d.children.forEach((b,P)=>{p(b,s+u,P===d.children.length-1)})};return c.children.forEach((d,s)=>{p(d,"",s===c.children.length-1)}),l}}let v=new T,g=[],$="folder-az",k="classic";const n={repo:document.getElementById("repoInput"),branch:document.getElementById("branchInput"),fetchBtn:document.getElementById("fetchBtn"),wrapper:document.getElementById("treeWrapper"),empty:document.getElementById("emptyState"),status:document.getElementById("statusMsg"),lineNums:document.getElementById("lineNumbers"),treeContent:document.getElementById("treeContent"),privateBtn:document.getElementById("privateRepoBtn"),tokenPanel:document.getElementById("tokenSection"),ghToken:document.getElementById("ghToken"),saveToken:document.getElementById("saveTokenBtn"),clearToken:document.getElementById("clearTokenBtn"),copyAll:document.getElementById("copyAllBtn"),shareBtn:document.getElementById("shareBtn"),overlay:document.getElementById("shareOverlay"),shareInput:document.getElementById("shareInput"),copyShareBtn:document.getElementById("copyShareBtn"),closeOverlay:document.getElementById("closeOverlay"),sortBtnLabel:document.getElementById("sortBtnLabel"),styleBtnLabel:document.getElementById("styleBtnLabel"),dropdowns:document.querySelectorAll(".dropdown")};document.addEventListener("DOMContentLoaded",()=>{q(),S(),H(),O(),D(),n.fetchBtn.addEventListener("click",w),n.copyAll.addEventListener("click",N),n.privateBtn.addEventListener("click",()=>{const t=n.tokenPanel.style.display==="none";n.tokenPanel.style.display=t?"block":"none",m("UI","Toggle Private Panel")}),n.saveToken.addEventListener("click",C),n.clearToken.addEventListener("click",x),document.querySelectorAll(".repo-tag").forEach(t=>{t.addEventListener("click",()=>{const[e,i]=t.dataset.repo.split("/");n.repo.value=`${e}/${i}`,n.branch.value="main",w(),m("Fetch","Quick Start",`${e}/${i}`)})}),[n.repo,n.branch,n.ghToken].forEach(t=>t.addEventListener("keypress",e=>e.key==="Enter"&&(t===n.ghToken?C():w())))});function H(){const t=window.location.pathname;if(t.startsWith("/repo/")){const e=t.split("/").filter(i=>i);e.length>=3&&(n.repo.value=`${e[1]}/${e[2]}`,n.branch.value=e[3]||"main",w())}}function m(t,e,i=null){typeof gtag=="function"&&gtag("event",e,{event_category:t,event_label:i})}async function w(){const t=n.repo.value.trim(),e=n.branch.value.trim()||"main";if(!t.includes("/"))return f("Invalid format. Use 'user/repo'","error");n.empty&&(n.empty.style.display="none");const i=document.querySelector(".language-listing");i&&(i.style.display="none");const c=document.querySelector(".seo-link");c&&(c.style.display="none"),n.wrapper.style.display="none",n.wrapper.style.display="none",f(`Fetching ${t}...`,"loading"),n.fetchBtn.disabled=!0;try{const a=`ght_${t}_${e}`,r=!!localStorage.getItem("ght_token"),l=r?null:sessionStorage.getItem(a);if(l){g=JSON.parse(l),B(t,e),f("","");const p=`/repo/${t}/${e}/`;window.location.pathname!==p&&window.history.pushState(null,"",p)}else{const p=await v.getTree(t,e);if(g=p.tree,p.branch&&p.branch!==e){const d=p.branch;f(`Branch '${e}' not found. Switched to '${d}'.`,"loading"),n.branch.value=d,B(t,d);const s=`ght_${t}_${d}`;if(!r)try{sessionStorage.setItem(s,JSON.stringify(g))}catch{}const o=`/repo/${t}/${d}/`;window.history.replaceState(null,"",o)}else{if(!r)try{sessionStorage.setItem(a,JSON.stringify(g))}catch{}B(t,e),f("","");const d=`/repo/${t}/${e}/`;window.location.pathname!==d&&window.history.pushState(null,"",d)}}I(),n.wrapper.style.display="flex"}catch(a){console.error(a);let r=a.message;r.includes("401")||r.includes("Bad credentials")?f("Invalid Private Token. Please check your settings.","error"):r.includes("403")||r.includes("Rate Limit")?f("API Limit Exceeded. Add a Token.","error"):r.includes("404")?f("Repository not found (or is Private).","error"):f(r,"error"),n.empty.style.display="block"}finally{n.fetchBtn.disabled=!1}}function I(){n.lineNums.innerHTML="",n.treeContent.innerHTML="";const t=v.sortTree(g,$),e=M(t),i=document.createDocumentFragment(),c=document.createDocumentFragment();e.forEach((a,r)=>{const l=document.createElement("div");l.textContent=r+1,i.appendChild(l);const p=document.createElement("div");p.className="tree-line",p.style.animation=`fadeIn 0.1s forwards ${Math.min(r*2,500)}ms`,p.style.opacity="0";const d=a.type==="tree"?"fa-solid fa-folder":"fa-regular fa-file",s=a.type==="tree"?"folder":"file";let o=a.prefix,h=a.name;k==="minimal"&&(o=a.indent),k==="plus"&&(o=o.replace(/â””â”€â”€/g,"+--").replace(/â”œâ”€â”€/g,"+--").replace(/â”‚/g,"|")),k==="slashed"&&(a.type==="tree"&&(h=`/${a.name}`),o=a.prefix.replace(/â”‚/g," ").replace(/â”œâ”€â”€/g," ").replace(/â””â”€â”€/g," ")),p.innerHTML=`
            <span class="t-prefix">${o}</span>
            <span class="t-icon"><i class="${d}"></i></span>
            <span class="t-name ${s}">${h}</span>
            <button class="sub-copy" data-path="${a.path}" title="Copy Path">
                <i class="far fa-copy"></i>
            </button>
        `,c.appendChild(p)}),n.lineNums.appendChild(i),n.treeContent.appendChild(c),n.treeContent.onclick=a=>{const r=a.target.closest(".sub-copy");r&&L(r,r.dataset.path,!0)}}function M(t){const e={children:[]},i={"":e};t.forEach(r=>{i[r.path]={...r,name:r.path.split("/").pop(),children:[]}}),t.forEach(r=>{const l=r.path.split("/");l.pop(),(i[l.join("/")]||e).children.push(i[r.path])});const c=[],a=(r,l,p)=>{const d=p?"â””â”€â”€ ":"â”œâ”€â”€ ";if(c.push({name:r.name,path:r.path,type:r.type,prefix:l+d,indent:l.replace(/â”‚   /g,"    ").replace(/â”œâ”€â”€ /g,"    ").replace(/â””â”€â”€ /g,"    ")}),r.children){const s=l+(p?"    ":"â”‚   ");r.children.forEach((o,h)=>{a(o,s,h===r.children.length-1)})}};return e.children.forEach((r,l)=>{a(r,"",l===e.children.length-1)}),c}function L(t,e,i){navigator.clipboard.writeText(e).then(()=>{if(i){const c=t.querySelector("i"),a=c.className;c.className="fas fa-check",setTimeout(()=>{c.className=a},1500),m("Copy","Single Path")}else{const c=t.innerHTML;t.innerHTML='<i class="fas fa-check"></i> Copied',setTimeout(()=>{t.innerHTML=c},1500),m("Copy","Full Tree")}}).catch(c=>console.error("Copy failed",c))}function N(){const t=v.generateAsciiTree(g);L(n.copyAll,t,!1)}function C(){const t=n.ghToken.value.trim();t&&(localStorage.setItem("ght_token",t),v=new T(t),S(),f("Token saved.","loading"),setTimeout(()=>f("",""),1500),m("Settings","Token Saved"))}function x(){localStorage.removeItem("ght_token"),n.ghToken.value="",v=new T(null),S(),f("Token cleared.","error"),setTimeout(()=>f("",""),1500),m("Settings","Token Cleared")}function S(){const t=localStorage.getItem("ght_token");t?(n.ghToken.value=t,n.privateBtn.innerHTML='<i class="fas fa-lock-open"></i> Private Active',n.privateBtn.style.color="var(--folder-color)",n.saveToken.style.display="none",n.clearToken.style.display="inline-block",v=new T(t)):(n.privateBtn.innerHTML='<i class="fas fa-lock"></i> Private Access',n.privateBtn.style.color="",n.saveToken.style.display="inline-block",n.clearToken.style.display="none")}function O(){[n.sortBtnLabel,n.styleBtnLabel].forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation();const i=t.parentElement;E(i),i.classList.toggle("active")})}),document.querySelectorAll("[data-sort]").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),$=e.target.dataset.sort,n.sortBtnLabel.innerHTML=`<i class="fas fa-sort-amount-down"></i> ${e.target.innerText}`,E(),I(),m("UI","Sort Change",$)})}),document.querySelectorAll("[data-style]").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),k=e.target.dataset.style,n.styleBtnLabel.innerHTML=`<i class="fas fa-code-branch"></i> ${e.target.innerText}`,E(),I(),m("UI","Style Change",k)})}),document.addEventListener("click",()=>E())}function B(t,e){document.title=`${t} File Structure : GitHubTree`;let i=document.querySelector('meta[name="description"]');i||(i=document.createElement("meta"),i.name="description",document.head.appendChild(i)),i.content=`Explore ${t} on branch ${e}. Visualize files without cloning.`;let c=document.querySelector('link[rel="canonical"]');c||(c=document.createElement("link"),c.rel="canonical",document.head.appendChild(c)),c.href=`https://githubtree.mgks.dev/repo/${t}/${e}/`}function E(t=null){n.dropdowns.forEach(e=>{e!==t&&e.classList.remove("active")})}function D(){n.shareBtn.addEventListener("click",t=>{t.stopPropagation(),n.shareInput.value=window.location.href,n.overlay.classList.add("visible"),m("Share","Open Modal")}),n.closeOverlay.addEventListener("click",()=>n.overlay.classList.remove("visible")),n.overlay.addEventListener("click",t=>{t.target===n.overlay&&n.overlay.classList.remove("visible")}),n.shareInput.addEventListener("click",()=>n.shareInput.select()),n.copyShareBtn.addEventListener("click",()=>{L(n.copyShareBtn,n.shareInput.value,!0),m("Share","Copy Link")})}function f(t,e){n.status.style.display=t?"block":"none",n.status.innerText=t,n.status.className=e}function q(){const t=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",t),document.getElementById("themeToggle").addEventListener("click",()=>{const e=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),m("UI","Theme Toggle",e)})}const A=document.createElement("style");A.innerHTML="@keyframes fadeIn { to { opacity: 1; } }";document.head.appendChild(A);
